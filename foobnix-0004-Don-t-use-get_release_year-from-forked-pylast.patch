From 61279e18254eb048489822f684342cc0db768834 Mon Sep 17 00:00:00 2001
From: Peter Lemenkov <lemenkov@gmail.com>
Date: Sat, 9 Jul 2011 19:16:43 +0400
Subject: [PATCH 4/4] Don't use get_release_year from forked pylast

Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>
---
 src/foobnix/regui/service/lastfm_service.py |   11 ++++++++++-
 1 files changed, 10 insertions(+), 1 deletions(-)

diff --git a/src/foobnix/regui/service/lastfm_service.py b/src/foobnix/regui/service/lastfm_service.py
index d5c6a6d..b08d250 100644
--- a/src/foobnix/regui/service/lastfm_service.py
+++ b/src/foobnix/regui/service/lastfm_service.py
@@ -478,7 +478,16 @@ class LastFmService():
             return None
         album = self.cache.get_album(artist, title);
         if album:
-            return album.get_release_year()
+            st_date = str(album.get_release_date())
+            try:
+                dt = datetime.datetime.strptime(st_date, "%d %b %Y, %H:%M")
+            except:
+                if st_date:
+                    i = st_date.find(",")
+                    return st_date[i - 4:i]
+                else:
+                    return st_date
+            return str(dt.year)
 
     def get_album_image_url(self, artist, title, size=pylast.COVER_LARGE):
         if not self.connect():
-- 
1.7.6

